@model AspChat.Models.ChatViewModel

@{ var userName = @Model.ThisUser.Name; }

<h4>Вы вошли как @userName</h4>

<div>Напишите сообщение в чат:</div>
<input type="text" id="message" />
<input type="button" value="send" id="send" />

<div id='messages'>
    @foreach (var msg in @Model.ChatMessages) {
        <p>@msg.ChatUserName: @msg.Text</p>
    }
</div>

<script>
    var socket,
        $txt = document.getElementById('message'),
        $messages = document.getElementById('messages');

    if (typeof (WebSocket) !== 'undefined') {
        socket = new WebSocket("ws://simplersvpapp.com/ChatHandler.ashx");
    } else {
        alert("Связь здесь не работает!");
    }

    socket.onmessage = function (msg) {
        var $el = document.createElement('p');
        $el.innerHTML = msg.data;
        $messages.appendChild($el);
    };

    socket.onclose = function () {
        alert('Связь не работает. Пожалуйста, обновите страницу');
    };

    document.getElementById('send').onclick = function () {
        socket.send('@userName: ' + $txt.value);
        $txt.value = '';
    };
</script>